################################
######## CANCEL_PRINT ##########
################################
[gcode_macro CANCEL_PRINT]
description: Cancel the actual running print
rename_existing: CANCEL_PRINT_BASE
variable_park: True
gcode:
    {% set printcfg = printer['gcode_macro _printcfg'] %} ; get printcfg variables
    M{printcfg.output} Print Canceled ; status feedback
    {% if printcfg.led_status == True %}
        {printcfg.status_error} ; LED feedback
    {% endif %}
    ## Move head and retract only if not already in the pause state and park set to true
    {% if printer.pause_resume.is_paused|lower == 'false' and park|lower == 'true'%}
        {% if printer.toolhead.homed_axes == "xyz" %}
            _TOOLHEAD_PARK_PAUSE_CANCEL
        {% endif %}
    {% endif %}
    {% if printcfg.audio_status == True %}
        {printcfg.error_audio} ; audio feedback
    {% endif %}
    STOP_COMPONENTS
    TURN_OFF_HEATERS
    CANCEL_PRINT_BASE

################################
########### PAUSE ##############
################################
[gcode_macro PAUSE]
description: Pause the actual running print
rename_existing: PAUSE_BASE
gcode:
    {% set printcfg = printer['gcode_macro _printcfg'] %} ; get printcfg variables
    M{printcfg.output} Print Paused ; status feedback
    {% if printcfg.led_status == True %}
        {printcfg.status_busy} ; LED feedback
    {% endif %}
    _SET_IDLER TIME={printcfg.pause_idle_time} POWER=1 EXTRUDER=0 BED=1 CHAMBER=1 STEPPERS=1
    PAUSE_BASE
    _TOOLHEAD_PARK_PAUSE_CANCEL

################################
########### RESUME #############
################################
[gcode_macro RESUME]
description: Resume the actual running print
rename_existing: RESUME_BASE
gcode:
    {% set printcfg = printer['gcode_macro _printcfg'] %} ; get printcfg variables
    ##### read extrude from  _TOOLHEAD_PARK_PAUSE_CANCEL  macro #####
    {% set extrude = printcfg.park_extrude %}
    #### get VELOCITY parameter if specified ####
    {% if 'VELOCITY' in params|upper %}
        {% set get_params = ('VELOCITY=' + params.VELOCITY)  %}
    {%else %}
        {% set get_params = "" %}
    {% endif %}
    ##### end of definitions #####
    {% if printer.extruder.can_extrude|lower == 'true' %}
        #SET_IDLE_TIMEOUT TIMEOUT=600
        M83
        G1 E{extrude} F2100
        {% if printer.gcode_move.absolute_extrude |lower == 'true' %} M82 {% endif %}
    {% else %}
        M{printcfg.output|int} Extruder not hot enough
    {% endif %}  
    M{printcfg.output} Print Resumed ; status feedback
    {% if printcfg.led_status == True %}
        {printcfg.status_printing} ; LED feedback
    {% endif %}
    {% if printcfg.audio_status == True %}
        {printcfg.resume_audio} ; audio feedback
    {% endif %}
    _SET_IDLER TIME={printcfg.idle_time} POWER=0
    RESUME_BASE {get_params}
